<!doctype html>
<html>
<head>
<title>投票机</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui"/>
<style>
body{font-size:12px;padding:0;margin:0;}
#list{padding:5px;}
.fixed{width:100%;height:30px;line-height:30px;text-align:center;background:#49C29B;color:#fff;position:fixed;bottom:0;z-index:1;}
.fixed a{padding:0 10px;}
#retimer{display:none;}
#index{width:30px;}
#number{color:#c00;}
</style>
</head>
<body>
<div id="list">

</div>
<div class="fixed">当前票数：<span id="number">--</span>｜编号(共:<span id="count">--</span>个)：<input id="index" value="0"/>｜<a id="button" href="javascript:;">开始</a></div>
<script src="jquery.js"></script>
<script>
$(document).ready(function(){
    $('#button').toggle(function() {
    	toupiao();
    	$(this).text('暂停');
    }, function() {
    	clearInterval(timer);
    	$(this).text('开始');
    });
});
$count = $('#count');
$number = $('#number');
$list = $('#list');	// 结果列表
count = 100;		// 投票列表总数
speed = 1000;		// 投票速度
// 开始投票
function toupiao() {
	timer = setInterval(function() {
	    $.ajax({
	         url: 'http://qinzi.xinbaby.com/toupiao?index=' + $('#index').val(),
	         dataType: 'jsonp',
	         jsonp: 'jsonpcallback',
	         success: function(data) {
	         	count = parseInt(data.count);
	            $number.text(data.number);
	            $count.text(data.count);
	            $list.prepend('<p>' + data.index + ':[' + data.time + '] ' + data.result + '</p>');
	         },
	         error: function() {
	         	$list.prepend('<p>连接超时!</p>');
	         }
	    });
	    // 循环index
	    var index = parseInt($('#index').val()) + 1;
	    if (index == count) {
	    	$('#index').val('0');
	    } else {
	    	$('#index').val(index);
	    }
    }, speed);
}
</script>
</body>
</html>
